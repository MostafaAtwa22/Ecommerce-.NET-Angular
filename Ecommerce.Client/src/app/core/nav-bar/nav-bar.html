<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white shadow-sm py-2 fixed-top">
  <div class="container-fluid">

    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center hover-scale" routerLink="/">
      <img src="nav-logo.png" height="55" width="140" alt="Logo" loading="lazy" />
    </a>

    <!-- Toggler -->
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarContent"
      aria-controls="navbarContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse justify-content-between" id="navbarContent">

      <ul class="navbar-nav mx-auto text-uppercase fw-semibold">
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" id="homeLink" routerLink="/home" routerLinkActive="active">Home</a>
        </li>
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" href="#shop" id="shopLink">Shop</a>
        </li>
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" href="#reviews" id="reviewsLink">Reviews</a>
        </li>
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" href="#contact" id="contactLink">Contact Us</a>
        </li>
      </ul>

      <!-- Right Section -->
      <ul class="navbar-nav align-items-center flex-row">
        <!-- Wishlist Icon -->
        <li class="nav-item position-relative me-3">
          <a class="nav-link wishlist-icon" routerLink="/wishlist">
            <i class="fas fa-heart"></i>
            <span class="wishlist-badge" *ngIf="wishList$ | async as wishList">{{ wishList.items.length }}</span>
          </a>
        </li>

        <!-- Shopping Cart -->
        <li class="nav-item position-relative me-4">
          <a class="nav-link cart-icon" routerLink="/basket">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-badge" *ngIf="basket$ | async as basket">{{ basket.items.length }}</span>
          </a>
        </li>

        <!-- Conditional User Buttons -->
        <ng-container *ngIf="isLoggedIn() && currentUser(); else guestButtons">
          <li class="nav-item dropdown">
            <button
              class="btn user-account-btn d-flex align-items-center gap-2"
              type="button"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <div class="user-avatar-small">
                <img
                  [src]="getAvatarUrl(currentUser())"
                  [alt]="currentUser()!.firstName || 'User'"
                  class="avatar-img"
                  (error)="setDefaultAvatar($event, currentUser()?.gender)"
                />
              </div>
              <span class="user-name d-none d-lg-inline">{{ currentUser()!.firstName }}</span>
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </button>

            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-modern">
              <!-- User Info Header -->
              <li class="dropdown-header user-info-header">
                <div class="d-flex align-items-center gap-3">
                  <div class="user-avatar-large">
                  <img
                  [src]="getAvatarUrl(currentUser())"
                  [alt]="currentUser()?.firstName || 'User'"
                  class="avatar-img"
                  (error)="setDefaultAvatar($event, currentUser()?.gender)"
                />
                  </div>
                  <div class="user-details">
                    <div class="user-full-name">
                      {{ currentUser()!.firstName }} {{ currentUser()!.lastName }}
                    </div>
                    <div class="user-email">{{ currentUser()!.email }}</div>
                    <div class="user-role" *ngIf="currentUser()!.roles && currentUser()!.roles.length > 0">
                      <i class="fas fa-shield-alt"></i>
                      {{ currentUser()!.roles[0] }}
                    </div>
                  </div>
                </div>
              </li>

              <li><hr class="dropdown-divider"></li>

              <!-- Menu Items -->
              <li>
                <a class="dropdown-item" routerLink="/profile">
                  <i class="fas fa-user"></i>
                  <span>Profile</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" routerLink="/orders">
                  <i class="fas fa-shopping-bag"></i>
                  <span>Orders</span>
                </a>
              </li>
              <li>
                <a class="dropdown-item" routerLink="/settings">
                  <i class="fas fa-cog"></i>
                  <span>Settings</span>
                </a>
              </li>

              <li><hr class="dropdown-divider"></li>

              <li>
                <button class="dropdown-item logout-item" (click)="logout()">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
                </button>
              </li>
            </ul>
          </li>
        </ng-container>
                <!-- Guest Buttons -->
        <ng-template #guestButtons>
          <li class="nav-item me-2">
            <a routerLink="/login" class="btn btn-outline-dark rounded-pill px-3 py-1 fw-semibold hover-scale">
              <i class="fas fa-sign-in-alt me-1"></i> Login
            </a>
          </li>
          <li class="nav-item">
            <a routerLink="/register" class="btn btn-dark rounded-pill px-3 py-1 fw-semibold hover-scale">
              <i class="fas fa-user-plus me-1"></i> Sign Up
            </a>
          </li>
        </ng-template>
      </ul>

    </div>
  </div>
</nav>
<!-- Navbar -->
