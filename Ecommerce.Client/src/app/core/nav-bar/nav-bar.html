<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-white shadow-sm py-2 fixed-top">
  <div class="container-fluid">

    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center hover-scale" routerLink="/">
      <img src="assets/navbar/nav-logo.png" height="55" width="140" alt="Logo" loading="lazy" />
    </a>

    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"
      aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse justify-content-between" id="navbarContent">

      <ul class="navbar-nav mx-auto text-uppercase fw-semibold">
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" id="homeLink" routerLink="/home" routerLinkActive="active">Home</a>
        </li>
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" href="#shop" id="shopLink">Shop</a>
        </li>
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" href="#reviews" id="reviewsLink">Reviews</a>
        </li>
        <li class="nav-item mx-2">
          <a class="nav-link text-decoration-none" href="#contact" id="contactLink">Contact Us</a>
        </li>
        <!-- Dashboard link for Admin/SuperAdmin -->
        <li class="nav-item mx-2" *hasPermission="['Permissions.Roles.Read', 'Permissions.Account.Read']; mode: 'any'">
          <a class="nav-link text-decoration-none" routerLink="/dashboard" routerLinkActive="active">
            <i class="fas fa-chart-line me-1"></i>Dashboard
          </a>
        </li>
      </ul>

      <!-- Right Section -->
      <ul class="navbar-nav align-items-center flex-row">
        <!-- Wishlist Icon - Only for customers and users without admin roles -->
        <li class="nav-item position-relative me-3" *hasPermission="'Permissions.Orders.Create'">
          <a class="nav-link wishlist-icon" routerLink="/wishlist">
            <i class="fas fa-heart"></i>
            <span class="wishlist-badge" *ngIf="wishList$ | async as wishList">{{ wishList.items.length }}</span>
          </a>
        </li>

        <!-- Shopping Cart - Only for customers and users without admin roles -->
        <li class="nav-item position-relative me-4" *hasPermission="'Permissions.Orders.Create'">
          <a class="nav-link cart-icon" routerLink="/basket">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-badge" *ngIf="basket$ | async as basket">{{ basket.items.length }}</span>
          </a>
        </li>

        <!-- Conditional User Buttons -->
        <ng-container *ngIf="isLoggedIn() && currentUser(); else guestButtons">
          <li class="nav-item dropdown">
            <button class="btn user-account-btn d-flex align-items-center gap-2" type="button" data-bs-toggle="dropdown"
              aria-expanded="false">
              <div class="user-avatar-small">
                <img [src]="getAvatarUrl(currentUser())" [alt]="currentUser()!.firstName || 'User'" class="avatar-img"
                  (error)="setDefaultAvatar($event, currentUser()?.gender)" />
              </div>
              <span class="user-name d-none d-lg-inline">{{ currentUser()!.firstName }}</span>
              <i class="fas fa-chevron-down dropdown-arrow"></i>
            </button>

            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-modern">
              <!-- User Info Header -->
              <li class="dropdown-header user-info-header">
                <div class="d-flex align-items-center gap-3">
                  <div class="user-avatar-large">
                    <img [src]="getAvatarUrl(currentUser())" [alt]="currentUser()?.firstName || 'User'"
                      class="avatar-img" (error)="setDefaultAvatar($event, currentUser()?.gender)" />
                  </div>
                  <div class="user-details">
                    <div class="user-full-name">
                      {{ currentUser()!.firstName }} {{ currentUser()!.lastName }}
                    </div>
                    <div class="user-email">{{ currentUser()!.email }}</div>
                    <!-- Display multiple roles -->
                    <div class="user-roles" *ngIf="currentUser()!.roles && currentUser()!.roles.length > 0">
                      <div class="role-badges">
                        @for (role of currentUser()!.roles; track role) {
                          <span class="role-badge {{ getRoleBadgeClass(role) }}">
                            <i class="fas {{ getRoleIcon(role) }} me-1"></i>
                            {{ getRoleDisplayName(role) }}
                          </span>
                        }
                      </div>
                    </div>
                    <!-- Show primary role -->
                    <div class="user-primary-role" *ngIf="getPrimaryRole() as primaryRole">
                      <small class="text-muted">
                        <i class="fas fa-user-tie me-1"></i>
                        Primary: {{ getRoleDisplayName(primaryRole) }}
                      </small>
                    </div>
                  </div>
                </div>
              </li>

              <li>
                <hr class="dropdown-divider">
              </li>

              <!-- Menu Items -->
              <li>
                <a class="dropdown-item" routerLink="/profile">
                  <i class="fas fa-user"></i>
                  <span>Profile</span>
                </a>
              </li>

              <!-- Show Orders for Customers -->
              <li *ngIf="hasCustomerRole() && !hasAdminRole()">
                <a class="dropdown-item" routerLink="/orders">
                  <i class="fas fa-shopping-bag"></i>
                  <span>Orders</span>
                </a>
              </li>

              <!-- Show Dashboard for users with admin roles -->
              <li *ngIf="hasAdminRole()">
                <a class="dropdown-item" routerLink="/dashboard">
                  <i class="fas fa-chart-line"></i>
                  <span>Dashboard</span>
                </a>
              </li>

              <!-- Admin-specific menu items -->
              <li *ngIf="hasAdminRole()">
                <a class="dropdown-item" routerLink="/dashboard/products">
                  <i class="fas fa-box"></i>
                  <span>Manage Products</span>
                </a>
              </li>

              <li *ngIf="hasSuperAdminRole()">
                <a class="dropdown-item" routerLink="/dashboard/users">
                  <i class="fas fa-users"></i>
                  <span>Manage Users</span>
                </a>
              </li>

              <li>
                <hr class="dropdown-divider">
              </li>

              <li>
                <button class="dropdown-item logout-item" (click)="logout()">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
                </button>
              </li>
            </ul>
          </li>
        </ng-container>
        <!-- Guest Buttons -->
        <ng-template #guestButtons>
          <li class="nav-item me-2">
            <a routerLink="/login" class="btn btn-outline-dark rounded-pill px-3 py-1 fw-semibold hover-scale">
              <i class="fas fa-sign-in-alt me-1"></i> Login
            </a>
          </li>
          <li class="nav-item">
            <a routerLink="/register" class="btn btn-dark rounded-pill px-3 py-1 fw-semibold hover-scale">
              <i class="fas fa-user-plus me-1"></i> Sign Up
            </a>
          </li>
        </ng-template>
      </ul>

    </div>
  </div>
</nav>
