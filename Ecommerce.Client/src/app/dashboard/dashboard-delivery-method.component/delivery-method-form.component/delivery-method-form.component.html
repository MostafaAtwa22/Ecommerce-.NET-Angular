<form [formGroup]="form" (ngSubmit)="onSubmit()" class="delivery-form">
  <!-- Short Name Field -->
  <div class="mb-3">
    <label for="shortName" class="form-label fw-semibold">
      Method Name <span class="text-danger">*</span>
    </label>
    <input
      type="text"
      id="shortName"
      class="form-control"
      formControlName="shortName"
      [class.is-invalid]="isShortNameInvalid"
      placeholder="e.g., Standard Shipping, Express Delivery"
      maxlength="{{ MAX_NAME_LENGTH }}"
    >
    @if (isShortNameInvalid) {
      <div class="invalid-feedback">
        @if (shortName?.errors?.['required']) {
          <span>Method name is required</span>
        }
        @if (shortName?.errors?.['minlength']) {
          <span>Method name must be at least 3 characters</span>
        }
        @if (shortName?.errors?.['maxlength']) {
          <span>Method name cannot exceed {{ MAX_NAME_LENGTH }} characters</span>
        }
        @if (shortName?.errors?.['pattern']) {
          <span>Only letters, numbers, spaces, and hyphens are allowed</span>
        }
      </div>
    }
    <small class="text-muted d-block mt-1">
      {{ shortName?.value?.length || 0 }}/{{ MAX_NAME_LENGTH }} characters
    </small>
  </div>

  <!-- Description Field -->
  <div class="mb-3">
    <label for="description" class="form-label fw-semibold">
      Description <span class="text-danger">*</span>
    </label>
    <textarea
      id="description"
      class="form-control"
      rows="4"
      formControlName="description"
      [class.is-invalid]="isDescriptionInvalid"
      placeholder="Describe this delivery method..."
      maxlength="{{ MAX_DESC_LENGTH }}"
    ></textarea>
    @if (isDescriptionInvalid) {
      <div class="invalid-feedback">
        @if (description?.errors?.['required']) {
          <span>Description is required</span>
        }
        @if (description?.errors?.['minlength']) {
          <span>Description must be at least 10 characters</span>
        }
        @if (description?.errors?.['maxlength']) {
          <span>Description cannot exceed {{ MAX_DESC_LENGTH }} characters</span>
        }
      </div>
    }
    <small class="text-muted d-block mt-1">
      {{ description?.value?.length || 0 }}/{{ MAX_DESC_LENGTH }} characters
    </small>
  </div>

  <!-- Delivery Time & Price Row -->
  <div class="row g-3 mb-3">
    <!-- Delivery Time -->
    <div class="col-md-6">
      <label for="deliveryTime" class="form-label fw-semibold">
        Delivery Time (Days) <span class="text-danger">*</span>
      </label>
      <div class="input-group">
        <input
          type="number"
          id="deliveryTime"
          class="form-control"
          formControlName="deliveryTime"
          [class.is-invalid]="isDeliveryTimeInvalid"
          min="{{ MIN_DELIVERY_TIME }}"
          max="{{ MAX_DELIVERY_TIME }}"
          step="1"
        >
        <span class="input-group-text">days</span>
      </div>
      @if (isDeliveryTimeInvalid) {
        <div class="invalid-feedback">
          @if (deliveryTime?.errors?.['required']) {
            <span>Delivery time is required</span>
          }
          @if (deliveryTime?.errors?.['min']) {
            <span>Delivery time must be at least {{ MIN_DELIVERY_TIME }} day</span>
          }
          @if (deliveryTime?.errors?.['max']) {
            <span>Delivery time cannot exceed {{ MAX_DELIVERY_TIME }} days</span>
          }
          @if (deliveryTime?.errors?.['pattern']) {
            <span>Delivery time must be a whole number</span>
          }
        </div>
      }
      @if (deliveryTime?.valid) {
        <small class="text-success d-block mt-1">
          <i class="fas fa-calendar-check me-1"></i>
          Estimated delivery: {{ getEstimatedDeliveryDate() }}
        </small>
      }
    </div>

    <!-- Price -->
    <div class="col-md-6">
      <label for="price" class="form-label fw-semibold">
        Price ($) <span class="text-danger">*</span>
      </label>
      <div class="input-group">
        <span class="input-group-text">$</span>
        <input
          type="number"
          id="price"
          class="form-control"
          formControlName="price"
          [class.is-invalid]="isPriceInvalid"
          min="{{ MIN_PRICE }}"
          max="{{ MAX_PRICE }}"
          step="0.01"
        >
      </div>
      @if (isPriceInvalid) {
        <div class="invalid-feedback">
          @if (price?.errors?.['required']) {
            <span>Price is required</span>
          }
          @if (price?.errors?.['min']) {
            <span>Price must be at least ${{ MIN_PRICE }}</span>
          }
          @if (price?.errors?.['max']) {
            <span>Price cannot exceed ${{ MAX_PRICE }}</span>
          }
          @if (price?.errors?.['pattern']) {
            <span>Price must be a valid number (max 2 decimal places)</span>
          }
        </div>
      }
      @if (price?.valid && price?.value === 0) {
        <small class="text-success d-block mt-1">
          <i class="fas fa-gift me-1"></i>This will be displayed as FREE shipping
        </small>
      } @else if (price?.valid && price?.value > 0) {
        <small class="text-muted d-block mt-1">
          Shipping cost: {{ formatPrice(price?.value) }}
        </small>
      }
    </div>
  </div>

  <!-- Summary Card -->
  @if (form.valid) {
    <div class="card summary-card mb-3">
      <div class="card-header bg-light">
        <h6 class="mb-0"><i class="fas fa-eye me-2"></i>Preview</h6>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-muted">Method Name</h6>
            <p class="fw-bold">{{ shortName?.value }}</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Cost</h6>
            <p class="fw-bold {{ price?.value === 0 ? 'text-success' : '' }}">
              {{ formatPrice(price?.value) }}
            </p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Delivery Time</h6>
            <p class="fw-bold">{{ deliveryTime?.value }} days</p>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Estimated Delivery</h6>
            <p class="fw-bold">{{ getEstimatedDeliveryDate() }}</p>
          </div>
        </div>
        <hr>
        <h6 class="text-muted">Description</h6>
        <p class="mb-0">{{ description?.value }}</p>
      </div>
    </div>
  }

  <!-- Form Actions -->
  <div class="modal-footer mt-4 pt-3 border-top">
    <button
      type="button"
      class="btn btn-outline-secondary"
      (click)="onCancel()"
    >
      Cancel
    </button>
    <button
      type="submit"
      class="btn btn-primary"
      [disabled]="form.invalid"
    >
      @if (isEditing) {
        <i class="fas fa-save me-2"></i>Update Delivery Method
      } @else {
        <i class="fas fa-plus-circle me-2"></i>Create Delivery Method
      }
    </button>
  </div>
</form>
